# リファクタリング指示ガイド

このドキュメントは、DeepTrader プロジェクトで開発 AI がリファクタリングを行う際の指針を示します。既存機能の挙動を保ったままコードを整理・改善することを目的としています。

## 1. 対象範囲 (スコープ)

- `src/components` : UI コンポーネント
- `src/hooks` : カスタム React Hooks
- `src/lib` : 共通ユーティリティ
- `src/infrastructure` : 外部サービス連携
- `src/mastra` : AI エージェント関連

上記ディレクトリ内のコードを中心にリファクタリングを実施します。機能追加は行わず、既存の仕様を変更しないことを基本とします。

## 2. 前提条件

- Node.js 18 以上
- pnpm 8 以上
- 既存テストがすべて成功していること
- ルート `AGENTS.md` に定められたコーディング規約を遵守すること

## 3. リファクタリング手順

1. **影響調査**
   - 変更対象のモジュールと依存関係を調べ、修正箇所を洗い出します。
   - 仕様変更を伴わないことを確認します。
2. **テスト準備**
   - 変更前に `pnpm test` を実行し、現在のテストが通る状態であることを確認します。
   - テストが不足している場合は追加し、現状の振る舞いを保証します。
3. **実装**
   - 小さな単位でコードを改善します。例: 変数名の明確化、関数分割、重複コードの統合。
   - TypeScript の型安全性を高め、`any` 型は使用しません。
   - 変更後は `pnpm lint` と `pnpm typecheck` を実行し、静的解析を通過させます。
4. **動作確認**
   - `pnpm test` を再度実行し、すべてのテストが成功することを確認します。
   - 必要に応じてローカル開発サーバー（`pnpm dev`）で動作を確認します。
5. **コミット**
   - 変更内容をまとめ、コミットメッセージは `refactor: ` で始めます。
   - コミット後にプルリクエストを作成し、レビュアーに共有します。

## 4. 実行後の確認項目

- コンポーネントやフックの責務が明確になっているか
- 重複コードが除去されているか
- 型定義が正確で安全になっているか
- テスト・lint・型チェックがすべて成功しているか

以上を満たしていればリファクタリング完了となります。今後も継続的にコードの品質向上を図ってください。
