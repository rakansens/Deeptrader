# DeepTrader 開発ガイドライン

## 1. 開発フロー

DeepTraderプロジェクトでは、次の開発フローに従います：

1. 要件定義
2. テストケース作成
3. 実装
4. コードレビュー
5. テスト実行
6. マージ＆デプロイ

## 2. 開発方法論

### 2.1 テスト駆動開発 (TDD)

DeepTraderではTDDアプローチを採用します：

1. **テストの作成**: 機能を実装する前に、その機能のテストを作成します。
2. **実装**: テストが失敗することを確認した後、テストをパスするように機能を実装します。
3. **リファクタリング**: テストをパスしたら、コードをリファクタリングして改善します。

### 2.2 ドメイン駆動設計 (DDD)

DDDの原則に従い、ビジネスドメインを中心にコードを構築します：

1. **ユビキタス言語**: プロジェクト全体で一貫した用語を使用します。
2. **境界付けられたコンテキスト**: 明確な境界を持つドメインモデルを作成します。
3. **エンティティ、値オブジェクト、集約**: 適切なドメインオブジェクトを使用します。
4. **リポジトリ**: データアクセスを抽象化します。

## 3. コーディング規約

### 3.1 TypeScript

- [TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html)に従います。
- 厳格な型付けを使用し、`any`型の使用を避けます。
- インターフェースとタイプエイリアスを適切に使い分けます。

### 3.2 React / Next.js

- 関数コンポーネントとReact Hooksを使用します。
- App Routerを使用し、サーバーコンポーネントとクライアントコンポーネントを適切に分離します。
- コンポーネントは単一責任の原則に従って設計します。

### 3.3 命名規則

- **ファイル名**: 
  - コンポーネント: PascalCase (例: `ChartDisplay.tsx`)
  - ユーティリティ/ヘルパー: camelCase (例: `formatPrice.ts`)
  - テスト: `.test.ts` or `.spec.ts` サフィックス

- **変数/関数名**: camelCase

- **コンポーネント/クラス名**: PascalCase

- **定数**: UPPER_SNAKE_CASE

### 3.4 コメント

- コメントは「なぜ」を説明することに焦点を当て、「何」をしているかは自明なコードにします。
- 複雑なロジックや非自明な決定には必ずコメントを追加します。
- [JSDoc](https://jsdoc.app/)形式を使用して関数とクラスにドキュメントを追加します。

## 4. テスト戦略

### 4.1 テストツール

- **Jest**: ユニットテストとスナップショットテスト
- **React Testing Library**: UIコンポーネントのテスト
- **Cypress**: E2Eテスト
- **MSW (Mock Service Worker)**: APIモック

### 4.2 テスト種類

- **ユニットテスト**: 個々の関数、サービス、コンポーネントのテスト
- **統合テスト**: 複数のコンポーネントの相互作用のテスト
- **E2Eテスト**: ユーザージャーニーを模倣したエンドツーエンドテスト

### 4.3 テストカバレッジ

- ビジネスロジックに対して最低80%のテストカバレッジを目指します。
- 全てのドメインロジックには100%のテストカバレッジを目指します。
- UIコンポーネントは主要な機能と状態のみテストします。

## 5. バージョン管理

### 5.1 Git戦略

- **ブランチング戦略**: GitFlowを採用
  - `main`: 本番リリース用
  - `develop`: 開発用メインブランチ
  - `feature/*`: 新機能開発用
  - `bugfix/*`: バグ修正用
  - `release/*`: リリース準備用
  - `hotfix/*`: 緊急修正用

### 5.2 コミットメッセージ

コミットメッセージは以下の形式に従います：

```
<絵文字> <タイプ>: <タイトル>

<詳細な説明>
```

**タイプ**:
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更（空白、フォーマットなど）
- `refactor`: バグ修正や機能追加ではないコード変更
- `perf`: パフォーマンス向上のための変更
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやツールに関する変更

**例**:
```
🚀 feat: チャートコンポーネントに時間枠切り替え機能を追加

- 1分、5分、15分、1時間、4時間、日、週、月の時間枠を選択可能
- 選択した時間枠に応じてデータが再取得される
- 時間枠がローカルストレージに保存される
```

### 5.3 プルリクエスト

- PRには明確な説明と、関連するチケット番号を含めます。
- コードレビューは少なくとも1人のレビュアーによって行われる必要があります。
- CIパイプラインのテストが全て成功していることを確認します。
- コードの品質基準を満たしていることを確認します。

## 6. 環境設定

### 6.1 開発環境

- **Node.js**: v18.x以上
- **npm** または **yarn**
- **VS Code** (推奨エディタ)
  - 推奨拡張機能:
    - ESLint
    - Prettier
    - TypeScript Error Translator
    - Tailwind CSS IntelliSense

### 6.2 環境変数

- `.env.local`ファイルを使用して環境変数を管理します。
- `.env.example`ファイルに必要な環境変数のテンプレートを提供します。
- 機密情報は`.env.local`に保存し、リポジトリにコミットしないでください。

## 7. ドキュメント

- 新しい機能を追加する際は、必要に応じてドキュメントを更新します。
- APIエンドポイントはSwagger/OpenAPIでドキュメント化します。
- アーキテクチャの決定は`docs/architecture`ディレクトリに記録します。
- 主要なコンポーネントには使用例とAPIドキュメントを提供します。

## 8. パフォーマンス考慮事項

- 大きなライブラリは部分的にインポートします。
- 画像は最適化して使用します。
- クライアントサイドのデータフェッチングではキャッシングを活用します。
- パフォーマンス上の問題が疑われる場合は、React DevTools Profilerを使用して分析します。

## 9. アクセシビリティ

- WAI-ARIA標準に従います。
- キーボードナビゲーションをサポートします。
- 十分なコントラスト比を確保します。
- スクリーンリーダー互換性を確保します。

## 10. デプロイメント

### 10.1 CI/CD

- GitHub Actionsを使用して自動テストとデプロイを行います。
- PRごとにテストとlintチェックを実行します。
- `develop`ブランチへのマージでステージング環境にデプロイします。
- `main`ブランチへのマージで本番環境にデプロイします。

### 10.2 環境

- **開発環境**: ローカル開発用
- **ステージング環境**: テスト用、Vercelプレビュー
- **本番環境**: エンドユーザー向け、VercelとSupabase 